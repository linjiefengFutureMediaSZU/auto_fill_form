<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®æ¶æ„è®¾è®¡æµ·æŠ¥ (Project Architecture Poster)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                darkMode: true,
                background: '#0d1117',
                primaryColor: '#1f6feb',
                primaryTextColor: '#c9d1d9',
                primaryBorderColor: '#30363d',
                lineColor: '#8b949e',
                secondaryColor: '#161b22',
                tertiaryColor: '#161b22',
                fontFamily: '"JetBrains Mono", "PingFang SC", sans-serif'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d1117; /* GitHub Dark Dimmed */
            --card-bg: rgba(22, 27, 34, 0.8);
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-color: #58a6ff;
            --border-color: #30363d;
            --success-color: #238636;
            --border-radius: 16px;
            --glass-border: 1px solid rgba(240, 246, 252, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: "JetBrains Mono", "PingFang SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
            background-color: var(--bg-color);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(88, 166, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(188, 140, 255, 0.1) 0%, transparent 20%);
            color: var(--text-primary);
            line-height: 1.6;
            /* Poster sizing if printed, but for web we just maximize width */
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            padding: 40px;
            background: linear-gradient(180deg, rgba(22,27,34,0) 0%, rgba(22,27,34,0.5) 100%);
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            color: #ffffff;
            font-size: 3.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(90deg, #58a6ff, #bc8cff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        p.subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            font-weight: 300;
        }

        .poster-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
        }

        .diagram-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            border: var(--glass-border);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .diagram-section:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
            border-color: var(--accent-color);
        }

        .full-width {
            grid-column: span 2;
        }

        h2 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--text-primary);
            font-size: 1.4rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }
        
        h2::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 24px;
            background: var(--accent-color);
            margin-right: 15px;
            border-radius: 4px;
        }

        .english-note {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-family: "JetBrains Mono", monospace;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            /* background-color: rgba(0,0,0,0.2); */
            padding: 20px;
            border-radius: 8px;
        }
        
        .er-diagram .mermaid {
            overflow-x: auto;
            justify-content: center; 
        }

        /* Footer for the poster */
        footer {
            margin-top: 60px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .poster-grid {
                grid-template-columns: 1fr;
            }
            .full-width {
                grid-column: span 1;
            }
            h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>PROJECT ARCHITECTURE</h1>
        <p class="subtitle">Auto Fill Forms V3.0 | Technical Design Overview</p>
    </header>

    <div class="poster-grid">
        <!-- 1. System Architecture (Full Width) -->
        <div class="diagram-section full-width">
            <h2>
                ç³»ç»Ÿæ•´ä½“æ¶æ„
                <span class="english-note">System Architecture</span>
            </h2>
            <div class="mermaid">
flowchart TB
    subgraph ClientLayer ["ğŸ–¥ï¸ å®¢æˆ·ç«¯å±‚ (Renderer Process)"]
        Vue["Vue 3 å‰ç«¯åº”ç”¨"]
        Store["Pinia çŠ¶æ€ç®¡ç†"]
        Router["Vue Router è·¯ç”±"]
        Preload["Preload é¢„åŠ è½½è„šæœ¬<br/>(ContextBridge å®‰å…¨æ¡¥æ¥)"]
    end

    subgraph ApplicationLayer ["âš™ï¸ åº”ç”¨å±‚ (Main Process)"]
        IPC["IPC ä¸»è¿›ç¨‹å¤„ç†å™¨"]
        
        subgraph ServiceModule ["æ ¸å¿ƒæœåŠ¡æ¨¡å— (Services)"]
            AccService["Account è´¦å·æœåŠ¡"]
            FormService["Form è¡¨å•/æ¨¡æ¿æœåŠ¡"]
            AutoService["AutoFill è‡ªåŠ¨åŒ–æœåŠ¡"]
            DataService["Data æ•°æ®/æ—¥å¿—æœåŠ¡"]
        end
        
        Playwright["ğŸ­ Playwright è‡ªåŠ¨åŒ–å¼•æ“"]
    end

    subgraph InfrastructureLayer ["ğŸ’¾ åŸºç¡€è®¾æ–½å±‚ (Infrastructure)"]
        SQLite[("SQLite æœ¬åœ°æ•°æ®åº“")]
        FileSystem["æ–‡ä»¶ç³»ç»Ÿ (fs)"]
        Browser["Chromium æµè§ˆå™¨å®ä¾‹"]
        TargetWeb["ğŸŒ ç›®æ ‡è¡¨å•ç½‘ç«™"]
    end

    %% é€šä¿¡æµ
    Vue --> Store
    Store --> Preload
    Preload -- "IPC Invoke" --> IPC
    IPC --> AccService
    IPC --> FormService
    IPC --> AutoService
    IPC --> DataService

    %% æ•°æ®è®¿é—®
    AccService --> SQLite
    FormService --> SQLite
    DataService --> SQLite
    DataService --> FileSystem

    %% è‡ªåŠ¨åŒ–æµç¨‹
    AutoService --> Playwright
    Playwright --> Browser
    Browser -- "Actions" --> TargetWeb

    classDef container fill:#161b22,stroke:#30363d,stroke-width:2px,color:#c9d1d9;
    classDef component fill:#0d1117,stroke:#58a6ff,stroke-width:1px,color:#c9d1d9;
    classDef database fill:#0d1117,stroke:#e3b341,stroke-width:1px,color:#c9d1d9;
    
    class ClientLayer,ApplicationLayer,InfrastructureLayer,ServiceModule container;
    class Vue,Store,Router,Preload,IPC,AccService,FormService,AutoService,DataService,Playwright,FileSystem,Browser,TargetWeb component;
    class SQLite database;
            </div>
        </div>

        <!-- 2. Database Design (Full Width) -->
        <div class="diagram-section full-width er-diagram">
            <h2>
                æ•°æ®åº“è®¾è®¡
                <span class="english-note">Database Schema</span>
            </h2>
            <div class="mermaid">
erDiagram
    ACCOUNT_GROUPS ||--o{ ACCOUNTS : "åŒ…å«"
    FORM_FOLDERS ||--o{ FORM_TEMPLATES : "åŒ…å«"
    FORM_TEMPLATES ||--o{ FORM_FIELD_MAPPINGS : "æ‹¥æœ‰"
    ACCOUNTS ||--o{ FILL_LOGS : "ç”Ÿæˆ"
    FORM_TEMPLATES ||--o{ FILL_LOGS : "ç”Ÿæˆ"

    ACCOUNT_GROUPS {
        int id PK
        string group_name "åˆ†ç»„åç§°"
    }

    ACCOUNTS {
        int id PK
        int group_id FK
        string blogger_name "åšä¸»åç§°"
        string extra_json "JSONæ‰©å±•"
        int status "çŠ¶æ€"
    }

    FORM_TEMPLATES {
        int id PK
        string template_name "æ¨¡æ¿åç§°"
        string form_url "URL"
    }

    FORM_FIELD_MAPPINGS {
        int id PK
        string form_field_name "è¡¨å•å­—æ®µ"
        string account_field_name "è´¦å·å­—æ®µ"
        bool is_auto_mapping "è‡ªåŠ¨æ˜ å°„"
    }

    FILL_LOGS {
        int id PK
        string fill_result "ç»“æœ"
        string fail_reason "åŸå› "
    }
            </div>
        </div>

        <!-- 3.1 Auto-Fill Flow -->
        <div class="diagram-section">
            <h2>
                è‡ªåŠ¨å¡«è¡¨æµç¨‹
                <span class="english-note">Auto-Fill Process</span>
            </h2>
            <div class="mermaid">
flowchart TD
    Start([ğŸš€ å¼€å§‹]) --> Init[åˆå§‹åŒ–]
    Init --> Filter[ç­›é€‰è´¦å·]
    Filter --> Loop{æœªæ‰§è¡Œ?}
    
    Loop -- Yes --> Select[é€‰è´¦å·]
    Loop -- No --> End([ğŸ ç»“æŸ])

    Select --> Launch[å¯åŠ¨æµè§ˆå™¨]
    Launch --> Navigate[è·³è½¬URL]
    Navigate --> Check{åŠ è½½æˆåŠŸ?}
    
    Check -- No --> LogErr[è®°å½•é”™è¯¯]
    LogErr --> Close[å…³é—­]
    Close --> Loop

    Check -- Yes --> MapLoop{éå†å­—æ®µ}
    
    MapLoop --> Locate[ğŸ” å®šä½]
    Locate --> Found{å­˜åœ¨?}
    
    Found -- Yes --> Fill[âœï¸ å¡«å……]
    Fill --> MapLoop
    
    Found -- No --> Skip[è·³è¿‡/æŠ¥é”™]
    Skip --> MapLoop

    MapLoop -- Done --> Verify[âœ… éªŒè¯]
    Verify --> Submit{è‡ªåŠ¨æäº¤?}
    
    Submit -- Yes --> DoSubmit[æäº¤]
    DoSubmit --> LogOk[è®°å½•æˆåŠŸ]
    LogOk --> Close
            </div>
        </div>

        <!-- 3.2 Smart Location -->
        <div class="diagram-section">
            <h2>
                æ™ºèƒ½å®šä½ç­–ç•¥
                <span class="english-note">Smart Location</span>
            </h2>
            <div class="mermaid">
flowchart TD
    Input[è¾“å…¥å­—æ®µå] --> S1{ç­–ç•¥1: æ–‡æœ¬åŒ¹é…}
    S1 -- OK --> Found([âœ… æˆåŠŸ])
    S1 -- Fail --> S2{ç­–ç•¥2: Labelå…³è”}
    
    S2 -- OK --> Found
    S2 -- Fail --> S3{ç­–ç•¥3: Placeholder}
    
    S3 -- OK --> Found
    S3 -- Fail --> S4{ç­–ç•¥4: å±æ€§åŒ¹é…}
    
    S4 -- OK --> Found
    S4 -- Fail --> Err([âŒ å¤±è´¥])
            </div>
        </div>

        <!-- 3.3 IPC Sequence (Full Width) -->
        <div class="diagram-section full-width">
            <h2>
                æ•°æ®æµä¸ IPC é€šä¿¡
                <span class="english-note">Data Flow Sequence</span>
            </h2>
            <div class="mermaid">
sequenceDiagram
    participant UI as Vue UI
    participant Store as Pinia
    participant Bridge as Preload
    participant Main as Main Process
    participant DB as SQLite

    UI->>Store: fetchAccounts()
    Store->>Bridge: window.electronAPI.getAll()
    Bridge->>Main: ipc.invoke('account:getAll')
    
    activate Main
    Main->>DB: SELECT * FROM accounts
    DB-->>Main: Rows
    
    Main-->>Bridge: JSON Data
    deactivate Main
    
    Bridge-->>Store: Promise Resolve
    Store-->>UI: Update State
            </div>
        </div>
    </div>

    <footer>
        <p>Generated by Auto Fill Forms V3.0 Architecture Team</p>
    </footer>

</body>
</html>
