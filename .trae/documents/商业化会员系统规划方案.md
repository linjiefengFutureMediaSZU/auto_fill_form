# 商业化会员系统规划方案 (Commercialization Plan)

## 1. 总体架构演进：混合架构 (Hybrid Architecture)

本项目将从纯本地工具转型为 SaaS（软件即服务）模式，采用 **“本地执行 + 云端验证”** 的混合架构。

*   **客户端 (Electron)**：继续负责核心业务（自动化填表、本地数据存储），保持高性能和隐私安全。
*   **服务端 (Cloud Server)**：新增部分，负责用户身份认证、会员权益管理、功能鉴权。

## 2. 核心功能模块拆解

### 2.1 用户认证系统 (Auth System)
*   **功能**：注册、登录（手机号/微信扫码）、找回密码。
*   **实现**：客户端不再只查本地 `users` 表，而是请求云端 API 获取 `Token` (JWT)。

### 2.2 会员权益系统 (Entitlement System)
*   **权益定义**：
    *   **免费用户**：
        *   限制账号数量（如最多 3 个）
        *   限制每日填表次数
        *   无法使用批量导入/导出功能
        *   无法使用高级数据分析
    *   **VIP 会员**：
        *   无限账号数量
        *   无限填表次数
        *   解锁批量导入/导出
        *   解锁高级数据分析
        *   解锁云端备份功能
*   **实现**：后端下发 `permissions` 列表或 `vip_level`，前端据此控制 UI 显示和功能触发。

### 2.3 支付系统 (Payment)
*   **功能**：购买会员（月卡/年卡/永久）。
*   **对接渠道**：
    *   微信支付/支付宝（需企业资质）
    *   第三方聚合支付（如面包多、独角数卡，适合个人开发者）。

### 2.4 安全与防破解 (Security)
*   **代码混淆**：打包时使用混淆工具，增加逆向难度。
*   **核心逻辑云端化**：将部分关键参数或算法放在云端，非会员无法获取，从根本上限制功能使用。

## 3. 前端代码实现指南 (Vue 3 + Pinia)

### 3.1 VIP 状态管理 (Store)

创建 `src/stores/vip.js` 管理会员状态和权限。

```javascript
// src/stores/vip.js
import { defineStore } from 'pinia'
import { computed, ref } from 'vue'

export const useVipStore = defineStore('vip', () => {
  // 模拟从后端获取的用户信息
  const userInfo = ref({
    isVip: false,
    expireDate: null,
    level: 'free' // free, pro, enterprise
  })

  // 核心权益配置（Feature Flags）
  const features = computed(() => ({
    // 限制最大账号数
    maxAccounts: userInfo.value.isVip ? 9999 : 5,
    // 是否允许批量导入
    allowBatchImport: userInfo.value.isVip,
    // 是否允许导出
    allowExport: userInfo.value.isVip,
    // 是否允许分组管理
    allowGroupManage: true // 免费用户也能用，作为引流功能
  }))

  // 检查是否拥有某项权限
  const checkPermission = (featureKey) => {
    return features.value[featureKey]
  }

  // 激活会员（开发测试用）
  const activateVip = (plan) => {
    userInfo.value.isVip = true
    userInfo.value.level = 'pro'
  }

  return {
    userInfo,
    features,
    checkPermission,
    activateVip
  }
})
```

### 3.2 功能锁组件 (VipGuard)

封装 `VipGuard` 组件，包裹在付费功能外，拦截点击事件。

```vue
<!-- src/components/VipGuard.vue -->
<template>
  <div @click.capture="handleClick" :class="{ 'vip-locked': isLocked }">
    <slot></slot>
    <!-- 锁图标遮罩 -->
    <div v-if="isLocked" class="lock-overlay">
      <el-icon><Lock /></el-icon> 会员专属
    </div>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useVipStore } from '@/stores/vip'
import { ElMessageBox } from 'element-plus'

const props = defineProps({
  feature: { type: String, required: true } // 例如 'allowBatchImport'
})

const vipStore = useVipStore()
const isLocked = computed(() => !vipStore.checkPermission(props.feature))

const handleClick = (e) => {
  if (isLocked.value) {
    e.stopPropagation() // 阻止原有点击事件
    e.preventDefault()
    showPayModal()
  }
}

const showPayModal = () => {
  ElMessageBox.confirm(
    '该功能仅限 VIP 会员使用，是否前往开通？',
    '会员专属功能',
    { confirmButtonText: '去开通', cancelButtonText: '再看看' }
  ).then(() => {
    // 跳转到支付页面或打开支付弹窗
    console.log('Open payment window')
  })
}
</script>

<style scoped>
.vip-locked {
  position: relative;
  cursor: not-allowed;
  opacity: 0.8;
}
.lock-overlay {
  /* 样式实现略 */
}
</style>
```

### 3.3 业务接入示例

在 `Account.vue` 等页面中使用：

```vue
<!-- 批量导入按钮 -->
<vip-guard feature="allowBatchImport">
  <el-button @click="handleBatchImport">
    批量导入
  </el-button>
</vip-guard>
```

## 4. 实施路线图 (Roadmap)

### 第一阶段：基础设施准备（开发期）
- [ ] 前端：创建 `VipStore` 和 `VipGuard` 组件。
- [ ] 前端：在关键功能点（批量导入/导出、账号数量限制）接入 `VipGuard`。
- [ ] 本地模拟：实现本地 Mock 开通会员流程，验证功能锁逻辑。

### 第二阶段：服务端建设（部署期）
- [ ] 购买服务器和域名。
- [ ] 开发后端 API：登录、用户信息、订单创建。
- [ ] 数据库设计：用户表、订单表、权益表。

### 第三阶段：联调与上线（发布期）
- [ ] 客户端接入后端 API。
- [ ] 对接支付渠道回调。
- [ ] 发布 v2.0 版本，包含完整的会员体系。
